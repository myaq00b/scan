<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple Product Scanner</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Roboto', sans-serif;
    }
    .card {
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .search-input {
      max-width: 400px;
      margin: 0 auto 20px;
    }
    .loading {
      text-align: center;
      padding: 2rem;
    }
    .error-message {
      text-align: center;
      padding: 2rem;
      color: #dc3545;
    }
    .barcode-placeholder {
      background-color: #e9ecef;
      height: 40px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      font-size: 12px;
      margin-top: 10px;
    }
    .card-img-top {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .add-product-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    .image-preview {
      max-width: 100%;
      max-height: 200px;
      margin-top: 10px;
      border-radius: 8px;
    }
    .stat-item {
      padding: 10px;
      margin: 5px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center">Product Scanner</h1>
    <p class="text-center text-muted">
      Click on any product to view its barcode for scanning.
    </p>

    <h2 class="text-center">Product List</h2>
    <!-- Search Field -->
    <div class="search-input mb-4">
      <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
    </div>
    <!-- Product Cards -->
    <div id="productList" class="row">
      <div class="loading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading products from GitHub...</p>
      </div>
    </div>
  </div>

  <!-- Floating Add Button -->
  <button class="btn btn-primary add-product-btn" data-bs-toggle="modal" data-bs-target="#addProductModal">+</button>

  <!-- Modal for enlarged barcode -->
  <div class="modal fade" id="barcodeModal" tabindex="-1" aria-labelledby="modalProductName" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="modalProductName" class="modal-title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <div id="barcodeLoading" class="mb-2">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading barcode...</span>
            </div>
            <p>Loading barcode...</p>
          </div>
          <img id="modalBarcode" src="" alt="Enlarged Barcode" class="img-fluid" style="display: none;">
        </div>
      </div>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addProductForm">
            <div class="mb-3">
              <label for="productName" class="form-label">Product Name</label>
              <input type="text" class="form-control" id="productName" required>
            </div>
            
            <div class="mb-3">
              <label for="productImageInput" class="form-label">Product Image</label>
              <input type="file" class="form-control" id="productImageInput" accept="image/*" required>
              <img id="imagePreview" class="image-preview" style="display: none;">
            </div>
            
            <div class="mb-3">
              <label for="barcodeNumber" class="form-label">Barcode Number</label>
              <input type="text" class="form-control" id="barcodeNumber" placeholder="e.g., 104745613" required>
            </div>
            
            <div class="mb-3">
              <label for="securityCode" class="form-label">Security Code</label>
              <input type="password" class="form-control" id="securityCode" required>
            </div>
            
            <div id="addProductStatus" class="alert" style="display: none;"></div>
            
            <button type="submit" class="btn btn-primary w-100" id="submitProductBtn">Add Product</button>
          </form>
        </div>
      </div>
    </div>
  </div>



  <!-- Bootstrap JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Decode function
    function x9f2k(p8m) {
      try {
        const w4z = 0x5A;
        const j7n = p8m.split('').reverse().join('');
        const q2r = atob(j7n);
        let h5t = '';
        for (let i = 0; i < q2r.length; i++) {
          const v3c = q2r.charCodeAt(i) ^ w4z;
          h5t += String.fromCharCode(v3c);
        }
        return h5t;
      } catch (e) {
        return null;
      }
    }
    
    // Configuration
    const m8d7q = "https://raw.githubusercontent.com/YaqoobHerts/simple/refs/heads/main/products.json";
    const n4p2w = "https://raw.githubusercontent.com/YaqoobHerts/simple/refs/heads/main/products2.json";
    const t6r9s = x9f2k("=4DOjxDO84zO54ma7szb842P4kWappWO50mYrlmbu12O");
    const y3h8v = "store586";
    
    // GitHub API configuration
    const k5b1z = x9f2k("d4RN7gQPMsiDDYBCSMhHbIxN4czATQxPz0GEIMAbg8iY/8CbX0QLiNia+AhN78AN4wWGNMGMckTbTsTBpZjE2whCeIgESwwHqNhACgwbWgxarVgL7oSB48iMuMTP");
    const c7j4x = "YaqoobHerts";
    const f2g6l = "simple";
    const a1e9u = "main";
    
    let q8w5p = [];
    const d3v7m = {};

    // Image preview functionality
    document.getElementById('productImageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const preview = document.getElementById('imagePreview');
          preview.src = event.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Load products from both JSON files with cache busting
    async function r9t4h() {
      document.getElementById('productList').innerHTML = 
        `<div class="loading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading products from GitHub...</p>
        </div>`;

      try {
        // Add timestamp to prevent caching
        const s2x = new Date().getTime();
        
        // Load both products.json and products2.json with cache busting
        const [u7k, i4p] = await Promise.all([
          fetch(`${m8d7q}?_=${s2x}`, { cache: 'no-store' }),
          fetch(`${n4p2w}?_=${s2x}`, { cache: 'no-store' }).catch(() => ({ ok: false }))
        ]);

        let b6m = [];

        if (u7k.ok) {
          const l3z = await u7k.json();
          b6m = b6m.concat(l3z);
        }

        if (i4p.ok) {
          const o5n = await i4p.json();
          b6m = b6m.concat(o5n);
        }

        if (b6m.length === 0) {
          throw new Error('No products found');
        }

        q8w5p = b6m;
        console.log(`Successfully loaded ${q8w5p.length} products from GitHub`);
        h8j3v(q8w5p);
      } catch (error) {
        console.error('Error loading products from GitHub:', error);
        document.getElementById('productList').innerHTML = 
          `<div class="col-12">
            <div class="alert alert-danger">
              <h4 class="alert-heading">Data Loading Failed</h4>
              <p>Unable to load product data from GitHub.</p>
              <hr>
              <p class="mb-0">Please check your connection and try again later.</p>
            </div>
          </div>`;
        document.getElementById('searchInput').disabled = true;
      }
    }

    function h8j3v(g1c4y) {
      const e9w = document.getElementById('productList');
      e9w.innerHTML = '';
      
      if (g1c4y.length === 0) {
        e9w.innerHTML = 
          `<div class="col-12 text-center">
            <div class="alert alert-info">No products found matching your search.</div>
          </div>`;
        return;
      }
      
      g1c4y.forEach(z2t => {
        const p7r = document.createElement('div');
        p7r.className = 'col-12 col-md-4 mb-4 product-card';
        p7r.setAttribute('data-name', z2t.name.toLowerCase());
        
        p7r.innerHTML = 
          `<div class="card h-100" data-bs-toggle="modal" data-bs-target="#barcodeModal" 
               data-name="${z2t.name}" data-barcode="${z2t.barcodeImage}">
            <img src="${z2t.productImage}" class="card-img-top" alt="Product Image">
            <div class="card-body text-center">
              <h5 class="card-title">${z2t.name}</h5>
              <div class="barcode-placeholder">Click to view barcode</div>
            </div>
          </div>`;
        
        e9w.appendChild(p7r);
      });
    }

    // Upload image to ImgBB
    async function v6n2q(s8k) {
      try {
        const m3w = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const j9h = reader.result.split(',')[1];
            resolve(j9h);
          };
          reader.onerror = reject;
          reader.readAsDataURL(s8k);
        });
        
        const l4x = new FormData();
        l4x.append('key', t6r9s);
        l4x.append('image', m3w);
        
        const p2z = await fetch('https://api.imgbb.com/1/upload', {
          method: 'POST',
          body: l4x
        });
        
        if (!p2z.ok) {
          throw new Error(`ImgBB API error: ${p2z.status}`);
        }
        
        const r5v = await p2z.json();
        
        if (!r5v.success) {
          throw new Error('ImgBB upload failed');
        }
        
        return r5v.data.url;
      } catch (error) {
        console.error('ImgBB upload error:', error);
        throw error;
      }
    }

    // GitHub API functions
    async function w7q3n(u9d) {
      if (!k5b1z) {
        throw new Error('GitHub token not configured');
      }

      const t2m = await fetch(
        `https://api.github.com/repos/${c7j4x}/${f2g6l}/contents/${u9d}?ref=${a1e9u}`,
        {
          headers: {
            'Authorization': `token ${k5b1z}`,
            'Accept': 'application/vnd.github.v3+json'
          },
          cache: 'no-store'
        }
      );
      
      if (t2m.status === 404) {
        return { sha: null, content: [] };
      }
      
      if (!t2m.ok) {
        throw new Error(`GitHub API error: ${t2m.statusText}`);
      }
      
      const h6p = await t2m.json();
      const x4v = JSON.parse(atob(h6p.content));
      
      return { sha: h6p.sha, content: x4v };
    }

    async function b8k5r(n3w, y7t, z1m) {
      if (!k5b1z) {
        throw new Error('GitHub token not configured');
      }

      const q6h = btoa(JSON.stringify(y7t, null, 2));
      
      const j9p = {
        message: `Add new product: ${new Date().toISOString()}`,
        content: q6h,
        branch: a1e9u
      };
      
      if (z1m) {
        j9p.sha = z1m;
      }
      
      const l4c = await fetch(
        `https://api.github.com/repos/${c7j4x}/${f2g6l}/contents/${n3w}`,
        {
          method: 'PUT',
          headers: {
            'Authorization': `token ${k5b1z}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(j9p),
          cache: 'no-store'
        }
      );
      
      if (!l4c.ok) {
        const s8x = await l4c.json();
        throw new Error(`GitHub update failed: ${s8x.message}`);
      }
      
      return await l4c.json();
    }

    // Show status message
    function i2x7k(v3q, e8n) {
      const w4h = document.getElementById('addProductStatus');
      w4h.className = `alert alert-${e8n}`;
      w4h.textContent = v3q;
      w4h.style.display = 'block';
    }

    // Handle form submission
    document.getElementById('addProductForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const p5z = document.getElementById('productName').value.trim();
      const m7w = document.getElementById('productImageInput').files[0];
      const r3k = document.getElementById('barcodeNumber').value.trim();
      const t9n = document.getElementById('securityCode').value;
      const u6h = document.getElementById('submitProductBtn');
      
      // Validate security code
      if (t9n !== y3h8v) {
        i2x7k('❌ Something went wrong. Invalid security code.', 'danger');
        return;
      }
      
      // Disable button and show progress
      u6h.disabled = true;
      i2x7k('⏳ Uploading image to ImgBB...', 'info');
      
      try {
        // Step 1: Upload image to ImgBB
        const j8q = await v6n2q(m7w);
        i2x7k('⏳ Image uploaded! Saving to GitHub...', 'info');
        
        // Step 2: Create product object
        const l2v = {
          name: p5z,
          productImage: j8q,
          barcodeImage: `https://barcodeapi.org/api/auto/${r3k}`
        };
        
        // Step 3: Get current products2.json
        const { sha: x4d, content: c9p } = await w7q3n('products2.json');
        
        // Step 4: Append new product
        c9p.push(l2v);
        
        // Step 5: Update products2.json in GitHub
        await b8k5r('products2.json', c9p, x4d);
        
        // Success!
        i2x7k('✅ Product added successfully!', 'success');
        
        // Reset form
        document.getElementById('addProductForm').reset();
        document.getElementById('imagePreview').style.display = 'none';
        
        // Reload products
        setTimeout(() => {
          r9t4h();
          bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
        }, 2000);
        
      } catch (error) {
        console.error('Error adding product:', error);
        i2x7k(`❌ Error: ${error.message}`, 'danger');
      } finally {
        u6h.disabled = false;
      }
    });

    // Barcode modal functionality
    const s7p = document.getElementById('barcodeModal');
    s7p.addEventListener('show.bs.modal', function (event) {
      const g2c = event.relatedTarget;
      const k9v = g2c.getAttribute('data-name');
      const m4x = g2c.getAttribute('data-barcode');
      
      document.getElementById('modalProductName').textContent = k9v;
      
      const w8h = document.getElementById('modalBarcode');
      const l3n = document.getElementById('barcodeLoading');
      
      w8h.style.display = 'none';
      l3n.style.display = 'block';
      
      if (d3v7m[k9v]) {
        w8h.src = d3v7m[k9v];
        w8h.style.display = 'block';
        l3n.style.display = 'none';
      } else {
        const q6z = new Image();
        q6z.onload = function() {
          d3v7m[k9v] = m4x;
          w8h.src = m4x;
          w8h.style.display = 'block';
          l3n.style.display = 'none';
        };
        
        q6z.onerror = function() {
          l3n.innerHTML = 
            `<div class="alert alert-warning">
              Failed to load barcode image. Please try again later.
            </div>`;
        };
        
        q6z.src = m4x;
      }
    });

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', function() {
      const v5m = this.value.toLowerCase();
      const p9x = q8w5p.filter(h7k => 
        h7k.name.toLowerCase().includes(v5m)
      );
      h8j3v(p9x);
    });

    // Load products on page load
    window.addEventListener('DOMContentLoaded', () => {
      r9t4h();
    });
  </script>
</body>
</html>


